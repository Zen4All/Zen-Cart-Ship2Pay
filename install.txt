------------------------------------------
  $Id: Ship2Pay,v 1.3.2 13:36 2008-07-19 ednique Exp $

  
-> based on :
  
  osCommerce, Open Source E-Commerce Solutions
  http://www.oscommerce.com

  Copyright (c) 2003 Edwin Bekaert (edwin@ednique.com)

  Released under the GNU General Public License

  http://forums.oscommerce.com/viewtopic.php?t=36112
  
  http://www.oscommerce.com/community/contributions,1042

  
-> modified to zen cart distribution by wladimirec

  tested on: Zen Cart Version v1.3.8
  
  
  ##
  
  fixed: undefined function calling in:
		/admin/includes/classes/shipping.php
		/admin/includes/classes/payment.php

-> V 1.5.2 - 2012-11-01 fdeboer
  tested on: Zen Cart Version 1.3.9h

  added: dutch language definitions
  fixed: obsolete $HTTP_GET/POST_VARS with $_GET/_POST
  fixed: admin button image links
  modified: moved language file to extra_definitions folder and merged manual language definitions from install into the language file.

------------------------------------------


SUMMARY:  (original description)
------------------------------------------
I needed a way to limit the number of payment options depending on the chosen shipping method.
For example When my client chooses pickup at store he should be able to select cash on pickup or moneyorder and when he chose flat rate shipping he should be able to select cash on delivery or moneyorder.

After installation, go to the admin > modules and click on ship 2 pay
insert your links between shipping and payment.
If you don't specify any link, the code will work as before.
I know that the admin could be easier, but i think this is fairly good as it is my first contribution.



      
 | INSTALLATION:
-+----------------------------------------
Unzip to a folder of your choice.
Copy new files on your server. 
Change the database as detailed in ship2pay.sql
***
Copy the files:
- /admin/ship2pay.php
- /admin/includes/classes/payment.php
- /admin/includes/classes/shipping.php
- /admin/includes/languages/english/extra_definitions/ship2pay.php
- /admin/includes/languages/dutch/extra_definitions/ship2pay.php      *(optional)
- /admin/includes/languages/polish/extra_definitions/ship2pay.php      *(optional)
- /admin/images/icons/icon_status_green_light.gif    *(optional, if not exist)
- /includes/classes/ship2pay.php
***
run (using your phpmyadmin):
ship2pay.sql
***

 |  Modify files:
-+------------------
1)	Open the file /includes/database_tables.php
and at the end add  (before ' ?>'):
	
define('TABLE_SHIP2PAY','ship2pay');
	
***

2)	Open the file /includes/filenames.php
and at the end add  (before ' ?>'):
define('FILENAME_SHIP2PAY', 'ship2pay.php');
define('TABLE_SHIP2PAY','ship2pay');
***

3)	Open the file /includes/classes/payment.php

Find the following line: (about line nr 33)
    	$this->modules = explode(';', MODULE_PAYMENT_INSTALLED);
replace that single line with:
      require(DIR_WS_CLASSES . 'ship2pay.php');
      $my_ship2pay = new ship2pay;	  
      $arrship=explode('_',$_SESSION['shipping']['id']);
      $ship2pay_mods = $my_ship2pay->get_pay_modules($arrship[0]);
      if (zen_not_null($ship2pay_mods)){
        $this->modules = explode(';', $ship2pay_mods);
      }else{
        $this->modules = explode(';', MODULE_PAYMENT_INSTALLED);
      }
***

4)	Open the file /admin/includes/boxes/modules_dhtml.php
Find the following line: (about line nr 29)

$za_contents[] = array( 'text' => BOX_MODULES_ORDER_TOTAL, 'link' => zen_href_link( FILENAME_MODULES, 'set=ordertotal',  'NONSSL' ) );

after add :

$za_contents[] = array( 'text' => BOX_MODULES_SHIP2PAY, 'link' => zen_href_link( FILENAME_SHIP2PAY, '',  'NONSSL' ) );


***


######### RUN #########

Go to the admin -> modules -> ship2pay and setup your ship2pay settings

#######################

That's it... I hope ;-)



DISCLAIMER:
------------------------------------------
If this should, for any reason, mess up something, which this should not be the cause of, you cannot hold me responsible.  If you should choose to use this, you agree to not hold me responsible.

UNINSTALLATION:
------------------------------------------
Reverse the installation steps